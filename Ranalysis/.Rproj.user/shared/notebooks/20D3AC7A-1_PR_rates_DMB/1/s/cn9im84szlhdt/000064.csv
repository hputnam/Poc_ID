"0",""
"0","### Bootstrapping ambient curve fit    "
"0","# refit model using nlsLM"
"0","grandis.fit_nlsLM <- minpack.lm::nlsLM(micromol.cm2.h~sharpeschoolhigh_1981(temp = temp, r_tref,e,eh,th, tref = 28),"
"0","                        data = d.grandis,"
"0","                        start = coef(grandis.fit),"
"0","                        lower = low_lims,"
"0","                        upper = upper_lims,"
"0","                        weights = rep(1, times = nrow(d.grandis)))"
"0",""
"0","# bootstrap using case resampling"
"0","grandis.boot1 <- Boot(grandis.fit_nlsLM, method = 'case')"
"0",""
"0","# look at the data"
"0","head(grandis.boot1$t)"
"1","    "
"1","   r_tref"
"1","         e"
"1","       eh"
"1"," th"
"1","
[1,]"
"1"," 1.856059"
"1"," 0.4275874"
"1"," 1.511712"
"1"," 36"
"1","
[2,]"
"1"," 1.856059"
"1"," 0.4359713"
"1"," 1.493776"
"1"," 36"
"1","
[3,]"
"1"," 1.856059"
"1"," 0.4769392"
"1"," 1.474094"
"1"," 36"
"1","
[4,]"
"1"," 1.856059"
"1"," 0.4449084"
"1"," 1.487235"
"1"," 36"
"1","
[5,]"
"1"," 1.856059"
"1"," 0.4158135"
"1"," 1.537861"
"1"," 36"
"1","
[6,]"
"1"," 1.856059"
"1"," 0.4507675"
"1"," 1.530401"
"1"," 36"
"1","
"
"0","# create predictions of each bootstrapped model"
"0","grandis.boot1_preds <- grandis.boot1$t %>%"
"0","  as.data.frame() %>%"
"0","  drop_na() %>%"
"0","  mutate(iter = 1:n()) %>%"
"0","  group_by_all() %>%"
"0","  do(data.frame(temp = seq(min(d.grandis$temp), max(d.grandis$temp), length.out = 100))) %>%"
"0","  ungroup() %>%"
"0","  mutate(pred = sharpeschoolhigh_1981(temp, r_tref, e, eh, th, tref = 28))"
"0",""
"0","# calculate bootstrapped confidence intervals"
"0","grandis.boot1_conf_preds <- group_by(grandis.boot1_preds, temp) %>%"
"0","  summarise(conf_lower = quantile(pred, 0.025),"
"0","            conf_upper = quantile(pred, 0.975)) %>%"
"0","  ungroup()"
"0",""
"0","# plot bootstrapped CIs"
"0","grandis.CI.plot <- ggplot() +"
"0","  geom_line(aes(temp, .fitted), grandis.preds, col = 'orange') +"
"0","  geom_ribbon(aes(temp, ymin = conf_lower, ymax = conf_upper), grandis.boot1_conf_preds, fill = 'orange', alpha = 0.3) +"
"0","  geom_point(aes(temp, micromol.cm2.h), d.grandis, size = 2, alpha = 0.5,col = 'orange') +"
"0","  theme_bw(base_size = 12) +"
"0","  labs(x = 'Temperature (ºC)',"
"0","       y = 'Rate (µmol O2/cm2/h')"
"0","grandis.CI.plot "
"0",""
